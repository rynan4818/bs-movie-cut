# 音ズレについて
PCで録画を行うと様々な原因で音ズレが発生しますが、カット前の元動画でズレておらず、
カットツールで切り出しを行う際にズレが発生する場合の対処法を記載します。

カット時の音ズレは、主にffmpegオプションをDEFALUTの -c copy (無劣化) オプションで実施する場合に発生しやすい様です。

ちなみに私の場合、録画はOBS Studioで下記の様な標準的な設定で行っており、音ズレは一度も発生していません。

![image](https://user-images.githubusercontent.com/14249877/130332669-18e365a4-4e0f-4bf6-81d9-403387c46bce.png)

## ① -async 1 オプション
-async 1 オプションを追加すると、映像と音声を最初に同期させる処理を行うため、音ズレが解消される場合があります。
- DEFALUT (無劣化コピー)
   -  -c copy **-async 1**
- Twitter (Twitter 投稿用)
   - -vcodec libx264 -pix_fmt yuv420p -strict -2 -acodec aac -ab 256k -vb 10240k **-async 1**

## ② キーフレーム単位でカットする
今回の更新で追加した、キーフレーム単位でカットする機能を有効にして、-c copy(無劣化) で切り出しを行うと、音ズレが解消される可能性があります。ただし、動画の長さが指定範囲よりも前後に多少長くなります。

なお、キーフレーム単位でカットするのは、映像の無劣化copy時のみ対象です。(エンコード時はその必要がないため)
キーフレーム単位でカットした方が再生互換性が高くなるため、多少動画が長くなっても構わないならば、音ズレが無くても有効にした方が良いと思います。

- 解説
   - 映像は時間軸方向に圧縮しているため、数秒毎に挿入されるキーフレームが無いと表示することが出来ません。そのため、無劣化ではキーフレーム単位でしか編集ができません。ただし、mp4等の動画形式では指定箇所から再生する機能があり、直近のキーフレームから格納して、実際の再生は指定時間から開始させることで任意の場所でカットしたように見せることが出来るようです。しかし再生プレーヤーが対応していないと上手く処理できず、また音声は指定時間からしか格納されていないため、再生時に上手く同期できないと音ズレの原因になるようです。

## ③ エンコードをする
エンコードを実施すると、音ズレが解消する可能性が高いです。また、可変フレームレート(VFR)だと編集時に音ズレの原因になる様です。
下記設定はVFRを固定フレーム(CFR)に変換し、なるべく劣化を抑えるために映像のみエンコードし、NVIDIAのグラフィックボードの機能を使って高速にエンコードする設定です。
- NVENC_Acopy
  -  -r 60 -vsync cfr -async 1 -c:a copy -vcodec h264_nvenc -vb 22M
        - -r 60 はフレームレートです 30にすると30fpsになります。 -vb 22Mはビットレートです。保存形態に合わせて調整してください。
